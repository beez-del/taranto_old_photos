<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <title>Mapa Taranto – MapLibre + Fotky</title>
  <link href="https://unpkg.com/maplibre-gl@3/dist/maplibre-gl.css" rel="stylesheet"/>
  <script src="https://unpkg.com/maplibre-gl@3/dist/maplibre-gl.js"></script>
  <style>
    body, #map { margin:0; padding:0; height:100vh; }
    .popup-img { max-width:200px; border-radius:8px; }
    .maplibregl-popup-content { padding: 10px; }
    .maplibregl-popup-content h3 { margin: 0 0 10px 0; }
  </style>
</head>
<body>
<div id="map"></div>
<script>
  const map = new maplibregl.Map({
    container: 'map',
    style: {
      version: 8,
      sources: {
        'osm-tiles': {
          type: 'raster',
          tiles: [
            'https://a.tile.openstreetmap.org/{z}/{x}/{y}.png',
            'https://b.tile.openstreetmap.org/{z}/{x}/{y}.png',
            'https://c.tile.openstreetmap.org/{z}/{x}/{y}.png'
          ],
          tileSize: 256,
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }
      },
      layers: [
        {
          id: 'osm-layer',
          type: 'raster',
          source: 'osm-tiles',
          minzoom: 0,
          maxzoom: 19
        }
      ]
    },
    center: [17.25, 40.47], 
    zoom: 12
  });

  map.addControl(new maplibregl.NavigationControl());

  map.on('load', () => {
    console.log('Mapa načtena!');
    
    // --- Hranice města ---
    fetch('./taranto.geojson')
      .then(res => {
        console.log('Načítám taranto.geojson...', res.status);
        return res.json();
      })
      .then(data => {
        console.log('Taranto data:', data);
        map.addSource('taranto', { type: 'geojson', data });
        map.addLayer({
          id: 'taranto-border',
          type: 'line',
          source: 'taranto',
          paint: { 
            'line-color': '#FF0000', 
            'line-width': 3,
            'line-opacity': 0.8
          }
        });
        
        // Přiblíž na hranice
        const bounds = new maplibregl.LngLatBounds();
        data.features[0].geometry.coordinates[0].forEach(coord => {
          bounds.extend(coord);
        });
        map.fitBounds(bounds, { padding: 30 });
      })
      .catch(err => console.error('Chyba při načítání taranto.geojson:', err));

    // --- Fotky ---
    fetch('./photos.geojson')
      .then(res => {
        console.log('Načítám photos.geojson...', res.status);
        return res.json();
      })
      .then(data => {
        console.log('Photos data:', data);
        map.addSource('photos', { type: 'geojson', data });
        
        // Použij kruhy místo ikon
        map.addLayer({
          id: 'photo-points',
          type: 'circle',
          source: 'photos',
          paint: {
            'circle-radius': 10,
            'circle-color': '#FF4444',
            'circle-stroke-color': '#FFFFFF',
            'circle-stroke-width': 3,
            'circle-opacity': 0.9
          }
        });

        // Popup po kliknutí
        map.on('click', 'photo-points', (e) => {
          const coords = e.features[0].geometry.coordinates.slice();
          const props = e.features[0].properties;
          new maplibregl.Popup()
            .setLngLat(coords)
            .setHTML(`
              <h3>${props.title}</h3>
              <img class="popup-img" src="${props.url}" alt="${props.title}"/>
            `)
            .addTo(map);
        });

        // Změna kurzoru na "ručičku"
        map.on('mouseenter', 'photo-points', () => { 
          map.getCanvas().style.cursor = 'pointer'; 
        });
        map.on('mouseleave', 'photo-points', () => { 
          map.getCanvas().style.cursor = ''; 
        });
      })
      .catch(err => console.error('Chyba při načítání photos.geojson:', err));
  });

  map.on('error', (e) => {
    console.error('Chyba mapy:', e);
  });
</script>
</body>
</html>
