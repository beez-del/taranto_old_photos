<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <title>Taranto ‚Äì old photos</title>
  <link href="https://unpkg.com/maplibre-gl@3/dist/maplibre-gl.css" rel="stylesheet"/>
  <script src="https://unpkg.com/maplibre-gl@3/dist/maplibre-gl.js"></script>
  <style>
    body, #map { margin:0; padding:0; height:100vh; }
    .popup-img { max-width:200px; border-radius:8px; }
    .maplibregl-popup-content { padding: 10px; }
    .maplibregl-popup-content h3 { margin: 0 0 10px 0; }
    
    /* Indik√°tor pou≈æit√©ho stylu */
    .style-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255,255,255,0.9);
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      z-index: 1;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .style-indicator.maptiler { color: #2196F3; }
    .style-indicator.free { color: #4CAF50; }
  </style>
</head>
<body>
<div id="map"></div>
<div class="style-indicator" id="styleIndicator">Naƒç√≠t√°m...</div>

<script>
  // ============================================
  // KONFIGURACE - ZMƒö≈á PODLE POT≈òEBY
  // ============================================
  
  const USE_MAPTILER = false;  // ‚Üê P≈ôepni na false pro pou≈æit√≠ OpenFreeMap
  
  // Automatick√° volba stylu
  const mapStyle = USE_MAPTILER 
    ? './my-style.json'        // MapTiler (s tv√Ωm API kl√≠ƒçem)
    : './my-style-free.json';  // OpenFreeMap (bez API kl√≠ƒçe)

  // ============================================
  // INICIALIZACE MAPY
  // ============================================
  
  const map = new maplibregl.Map({
    container: 'map',
    style: mapStyle,
    center: [17.25, 40.47], 
    zoom: 12
  });

  map.addControl(new maplibregl.NavigationControl());

  map.on('load', () => {
    console.log(`‚úÖ Mapa naƒçtena! Pou≈æ√≠v√°m: ${USE_MAPTILER ? 'MapTiler' : 'OpenFreeMap'}`);
    
    // Aktualizuj indik√°tor
    const indicator = document.getElementById('styleIndicator');
    if (USE_MAPTILER) {
      indicator.textContent = 'üîë MapTiler';
      indicator.className = 'style-indicator maptiler';
    } else {
      indicator.textContent = 'üåç OpenFreeMap';
      indicator.className = 'style-indicator free';
    }
    
    // --- Hranice mƒõsta ---
    fetch('./taranto.geojson')
      .then(res => {
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return res.json();
      })
      .then(data => {
        console.log('‚úÖ Taranto data naƒçtena');
        map.addSource('taranto', { type: 'geojson', data });
        map.addLayer({
          id: 'taranto-border',
          type: 'line',
          source: 'taranto',
          paint: { 
            'line-color': '#FF0000', 
            'line-width': 3,
            'line-opacity': 0.8
          }
        });
        
        // P≈ôibl√≠≈æ na hranice
        const bounds = new maplibregl.LngLatBounds();
        data.features[0].geometry.coordinates[0].forEach(coord => {
          bounds.extend(coord);
        });
        map.fitBounds(bounds, { padding: 30 });
      })
      .catch(err => console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ taranto.geojson:', err));

    // --- Fotky ---
    fetch('./photos.geojson')
      .then(res => {
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return res.json();
      })
      .then(data => {
        console.log('‚úÖ Photos data naƒçtena');
        map.addSource('photos', { type: 'geojson', data });
        
        // Kruhy pro fotky
        map.addLayer({
          id: 'photo-points',
          type: 'circle',
          source: 'photos',
          paint: {
            'circle-radius': 10,
            'circle-color': '#FF4444',
            'circle-stroke-color': '#FFFFFF',
            'circle-stroke-width': 3,
            'circle-opacity': 0.9
          }
        });

        // Popup po kliknut√≠
        map.on('click', 'photo-points', (e) => {
          const coords = e.features[0].geometry.coordinates.slice();
          const props = e.features[0].properties;
          new maplibregl.Popup()
            .setLngLat(coords)
            .setHTML(`
              <h3>${props.title}</h3>
              <img class="popup-img" src="${props.url}" alt="${props.title}"/>
            `)
            .addTo(map);
        });

        // Zmƒõna kurzoru na "ruƒçiƒçku"
        map.on('mouseenter', 'photo-points', () => { 
          map.getCanvas().style.cursor = 'pointer'; 
        });
        map.on('mouseleave', 'photo-points', () => { 
          map.getCanvas().style.cursor = ''; 
        });
      })
      .catch(err => console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ photos.geojson:', err));
  });

  // Zachycen√≠ chyb mapy (nap≈ô. neplatn√Ω API kl√≠ƒç)
  map.on('error', (e) => {
    console.error('‚ùå Chyba mapy:', e.error);
    
    // Pokud sel≈æe MapTiler, automaticky p≈ôepni na free
    if (USE_MAPTILER && e.error && e.error.status === 401) {
      console.warn('‚ö†Ô∏è MapTiler API kl√≠ƒç je neplatn√Ω! Zkus p≈ôepnout USE_MAPTILER na false');
      document.getElementById('styleIndicator').textContent = '‚ùå Chybn√Ω API kl√≠ƒç';
      document.getElementById('styleIndicator').style.color = 'red';
    }
  });
</script>
</body>
</html>

