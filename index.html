<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <title>Mapa Taranto – MapLibre + Fotky</title>
  <link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet"/>
  <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
  <style>
    body, #map { margin:0; padding:0; height:100vh; }
    .popup-img { max-width:200px; border-radius:8px; }
  </style>
</head>
<body>
<div id="map"></div>
<script>
  const map = new maplibregl.Map({
    container: 'map',
    style: './my-style.json',
    center: [17.25, 40.47], 
    zoom: 12
  });

  map.addControl(new maplibregl.NavigationControl());

  map.on('load', () => {
    // --- Hranice města ---
    fetch('./taranto.geojson')
      .then(res => res.json())
      .then(data => {
        map.addSource('taranto', { type: 'geojson', data });
        map.addLayer({
          id: 'taranto-border',
          type: 'line',
          source: 'taranto',
          paint: { 'line-color': '#FF0000', 'line-width': 2 }
        });
        const bbox = turf.bbox(data);
        map.fitBounds(bbox, { padding: 30 });
      });

    // --- Fotky ---
    fetch('./photos.geojson')
      .then(res => res.json())
      .then(data => {
        map.addSource('photos', { type: 'geojson', data });
        map.addLayer({
          id: 'photo-points',
          type: 'symbol',
          source: 'photos',
          layout: {
            'icon-image': 'marker-15',
            'icon-size': 1.5,
            'icon-allow-overlap': true
          }
        });

        // Popup po kliknutí
        map.on('click', 'photo-points', (e) => {
          const coords = e.features[0].geometry.coordinates.slice();
          const props = e.features[0].properties;
          new maplibregl.Popup()
            .setLngLat(coords)
            .setHTML(`
              <h3>${props.title}</h3>
              <img class="popup-img" src="${props.url}" alt="${props.title}"/>
            `)
            .addTo(map);
        });

        // Změna kurzoru na "ručičku"
        map.on('mouseenter', 'photo-points', () => { map.getCanvas().style.cursor = 'pointer'; });
        map.on('mouseleave', 'photo-points', () => { map.getCanvas().style.cursor = ''; });
      });
  });
</script>
</body>
</html>
